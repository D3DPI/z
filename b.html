<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>岭南乐器增强现实视听工具</title>
    <script src="aframe.min.js"></script>
    <script src="aframe-ar.js"></script>
    <style>
        #_0x5f4e{position:absolute;top:20px;left:20px;padding:10px 20px;background-color:grey;color:white;border:none;cursor:not-allowed;z-index:10}
        #_0x3a2d{position:absolute;top:70px;left:20px;width:calc(100% - 40px);padding:10px 20px;background-color:#FFF;color:#000;border:none;word-wrap:break-word;z-index:10}
    </style>
    <script>
    var _0x1a8d=['userAgent','test','addEventListener','DOMContentLoaded','body','innerHTML','<div style="text-align:center;padding:20px;"><p>为了获得更好的体验，请点击右上角菜单，选择"在默认浏览器中打开"。</p></div>','forEach','src','preload','auto','load','click','readyState','paused','play','then','textContent','catch','error','Audio playback failed:','无法播放音频，请与页面进行交互后重试。','pause','音频尚未加载完毕，请稍后再试。','没有检测到标记或音频尚未加载。','model-loaded','getObject3D','mesh','rotation','set','degToRad','marker-debug','getAttribute','id','audio1.mp3','info1.txt','audio2.mp3','info2.txt','Audio player not found for ','ok','Error loading info text:','throttleTick','object3D','visible','No information available','style','disabled','backgroundColor','#007BFF','cursor','pointer','播放','grey','not-allowed','Play'];
    (function(_0x5c0b30,_0x1a8d89){var _0x48b4cb=function(_0x85465){while(--_0x85465){_0x5c0b30['push'](_0x5c0b30['shift']());}};_0x48b4cb(++_0x1a8d89);}(_0x1a8d,0x1d3));
    var _0x48b4=function(_0x5c0b30,_0x1a8d89){_0x5c0b30=_0x5c0b30-0x0;var _0x48b4cb=_0x1a8d[_0x5c0b30];return _0x48b4cb;};
    
    function _0x85465(){return /MicroMessenger/i[_0x48b4('0x1')](navigator[_0x48b4('0x0')]);}
    var _0x3e7d9c=_0x85465();
    if(_0x3e7d9c){
        document[_0x48b4('0x2')](_0x48b4('0x3'),function(){
            document[_0x48b4('0x4')][_0x48b4('0x5')]=_0x48b4('0x6');
        });
    } else {
        var _0x2f7a9e = null;
        var _0x1f3d9f = {};
        document[_0x48b4('0x2')](_0x48b4('0x3'), function(){
            var _0x85465=['audio1.mp3','audio2.mp3'];
            _0x85465[_0x48b4('0x7')](function(_0x3e7d9c){
                var _0x2f7a9e=new Audio();
                _0x2f7a9e[_0x48b4('0x8')]=_0x3e7d9c;
                _0x2f7a9e[_0x48b4('0x9')]=_0x48b4('0xa');
                _0x2f7a9e[_0x48b4('0xb')]();
                _0x1f3d9f[_0x3e7d9c]={'audioPlayer':_0x2f7a9e};
            });
            var _0x34e280=document['getElementById']('_0x5f4e');
            _0x34e280[_0x48b4('0x2')](_0x48b4('0xc'),()=>{
                if(_0x2f7a9e && _0x2f7a9e['audioPlayer']){
                    var _0x85465=_0x2f7a9e['audioPlayer'];
                    if(_0x85465[_0x48b4('0xd')]>=0x2){
                        if(_0x85465[_0x48b4('0xe')]){
                            _0x85465[_0x48b4('0xf')]()[_0x48b4('0x10')](()=>{
                                _0x2f7a9e['isPlaying']=true;
                                _0x34e280[_0x48b4('0x11')]='暂停';
                            })[_0x48b4('0x12')](_0x3e7d9c=>{
                                console[_0x48b4('0x13')](_0x48b4('0x14'),_0x3e7d9c);
                                alert(_0x48b4('0x15'));
                            });
                        } else {
                            _0x85465[_0x48b4('0x16')]();
                            _0x2f7a9e['isPlaying']=false;
                            _0x34e280[_0x48b4('0x11')]=_0x48b4('0x35');
                        }
                    } else {
                        alert(_0x48b4('0x17'));
                    }
                } else {
                    alert(_0x48b4('0x18'));
                }
            });
        });

        AFRAME['registerComponent']('set-model-rotation',{
            'schema':{'x':{'type':'number','default':0x0},'y':{'type':'number','default':0x0},'z':{'type':'number','default':0x0}},
            'init':function(){
                var _0x85465=this['el'];
                var _0x3e7d9c=this['data'];
                _0x85465[_0x48b4('0x2')](_0x48b4('0x19'),function(_0x2f7a9e){
                    var _0x1f3d9f=_0x85465[_0x48b4('0x1a')](_0x48b4('0x1b'));
                    if(!_0x1f3d9f)return;
                    _0x1f3d9f[_0x48b4('0x1c')][_0x48b4('0x1d')](
                        THREE['Math'][_0x48b4('0x1e')](_0x3e7d9c['x']),
                        THREE['Math'][_0x48b4('0x1e')](_0x3e7d9c['y']),
                        THREE['Math'][_0x48b4('0x1e')](_0x3e7d9c['z'])
                    );
                });
            }
        });

        AFRAME['registerComponent'](_0x48b4('0x1f'),{
            'init':function(){
                var _0x85465=this['el'];
                var _0x3e7d9c=_0x85465[_0x48b4('0x20')](_0x48b4('0x21'));
                var _0x2f7a9e=null;
                var _0x4a9e9c='';
                var _0x4e83e4=false;
                var _0x34e280=document['getElementById']('_0x5f4e');
                var _0x223d06=document['getElementById']('_0x3a2d');
                var _0x42a934=false;
                var _0x15f8aa=false;
                var _0x4cbb6a=false;
                var _0x3527d9='';
                var _0x52f6e7='';
                if(_0x3e7d9c==='marker1'){
                    _0x3527d9=_0x48b4('0x22');
                    _0x52f6e7=_0x48b4('0x23');
                } else if(_0x3e7d9c==='marker2'){
                    _0x3527d9=_0x48b4('0x24');
                    _0x52f6e7=_0x48b4('0x25');
                }
                var _0x379c3b=_0x1f3d9f[_0x3527d9];
                if(_0x379c3b && _0x379c3b['audioPlayer']){
                    _0x2f7a9e=_0x379c3b['audioPlayer'];
                } else {
                    console[_0x48b4('0x13')](_0x48b4('0x26')+_0x3527d9);
                    _0x2f7a9e=new Audio();
                    _0x2f7a9e[_0x48b4('0x8')]=_0x3527d9;
                    _0x2f7a9e[_0x48b4('0x9')]=_0x48b4('0xa');
                    _0x2f7a9e[_0x48b4('0xb')]();
                }
                fetch(_0x52f6e7)
                    .then(_0x85465=>_0x85465[_0x48b4('0x27')]?_0x85465['text']:'')
                    .then(_0x85465=>{
                        _0x4a9e9c=_0x85465;
                        _0x4cbb6a=true;
                    })
                    .catch(_0x85465=>{
                        console[_0x48b4('0x13')](_0x48b4('0x28'),_0x85465);
                        _0x4cbb6a=false;
                    });
                
                this['tick']=AFRAME['utils'][_0x48b4('0x29')](function(){
                    var _0x85465=_0x85465[_0x48b4('0x2a')][_0x48b4('0x2b')];
                    if(_0x85465!==_0x42a934){
                        _0x42a934=_0x85465;
                        _0x15f8aa=_0x2f7a9e[_0x48b4('0xd')]>=0x2;
                        if(_0x42a934){
                            if(_0x2f7a9e && _0x2f7a9e['markerId']!==_0x3e7d9c){
                                if(_0x2f7a9e['audioPlayer'] && !_0x2f7a9e['audioPlayer'][_0x48b4('0xe')]){
                                    _0x2f7a9e['audioPlayer'][_0x48b4('0x16')]();
                                    _0x2f7a9e['isPlaying']=false;
                                }
                            }
                            _0x2f7a9e={
                                'markerId':_0x3e7d9c,
                                'audioPlayer':_0x2f7a9e,
                                'infoTextContent':_0x4a9e9c,
                                'isPlaying':_0x4e83e4,
                                'audioLoaded':_0x15f8aa,
                                'infoLoaded':_0x4cbb6a
                            };
                            _0x223d06[_0x48b4('0x11')]=_0x4a9e9c||_0x48b4('0x2c');
                            _0x4e1c16();
                        }
                    }
                },0x64);
                
                function _0x4e1c16(){
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x2e')]=false;
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x2f')]=_0x48b4('0x30');
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x31')]=_0x48b4('0x32');
                    _0x34e280[_0x48b4('0x11')]=_0x4e83e4?'暂停':_0x48b4('0x33');
                }
                
                function _0x5f4e16(){
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x2e')]=true;
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x2f')]=_0x48b4('0x34');
                    _0x34e280[_0x48b4('0x2d')][_0x48b4('0x31')]=_0x48b4('0x35');
                    _0x34e280[_0x48b4('0x11')]=_0x48b4('0x36');
                }
            }
        });
    }
    </script>
</head>
<body style="margin: 0; overflow: hidden;">
    <button id="_0x5f4e" disabled>播放</button>
    <div id="_0x3a2d">请用摄像头对准"岭南乐器码"</div>
    <a-scene embedded arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false" vr-mode-ui="enabled: false">
        <a-marker id="marker1" preset="custom" url="pattern1.patt" marker-debug>
            <a-entity id="model1" position="0 0 0" scale="0.02 0.02 0.02" gltf-model="model1.gltf" set-model-rotation="x:0; y:0; z:0"></a-entity>
        </a-marker>
        <a-marker id="marker2" preset="custom" url="pattern2.patt" marker-debug>
            <a-entity id="model2" position="0 0 0" scale="0.013 0.013 0.013" gltf-model="model2.gltf" set-model-rotation="x:0; y:0; z:0"></a-entity>
        </a-marker>
